<!doctype html>
<html lang="en">
<head>
    <title>Code coverage report for node-npmtest-hapi-auth-jwt2/node_modules/hapi-auth-jwt2/lib/index.js</title>
    <meta charset="utf-8">
    <style>
        body, html {
            margin:0; padding: 0;
        }
        body {
            font-family: Arial, Helvetica;
            font-size: 10pt;
        }
        div.header, div.footer {
            background: #eee;
            padding: 1em;
        }
        div.header {
            height: 160px;
            padding: 0 1em 0 1em;
            z-index: 100;
            position: fixed;
            top: 0;
            border-bottom: 1px solid #666;
            width: 100%;
        }
        div.footer {
            border-top: 1px solid #666;
        }
        div.body {
            margin-top: 170px;
        }
        div.meta {
            font-size: 90%;
            text-align: center;
        }
        h1, h2, h3 {
            font-weight: normal;
        }
        h1 {
            font-size: 12pt;
        }
        h2 {
            font-size: 10pt;
        }
        pre {
            font-family: Menlo, Monaco, Consolas, Courier New, monospace;
            margin: 0;
            padding: 0;
            font-size: 14px;
            tab-size: 2;
        }

        div.path { font-size: 110%; }
        div.path a:link, div.path a:visited { color: #000; }
        table.coverage { border-collapse: collapse; margin:0; padding: 0 }

        table.coverage td {
            margin: 0;
            padding: 0;
            color: #111;
            vertical-align: top;
        }
        table.coverage td.line-count {
            width: 50px;
            text-align: right;
            padding-right: 5px;
        }
        table.coverage td.line-coverage {
            color: #777 !important;
            text-align: right;
            border-left: 1px solid #666;
            border-right: 1px solid #666;
        }

        table.coverage td.text {
        }

        table.coverage td span.cline-any {
            display: inline-block;
            padding: 0 5px;
            width: 40px;
        }
        table.coverage td span.cline-neutral {
            background: #eee;
        }
        table.coverage td span.cline-yes {
            background: #b5d592;
            color: #999;
        }
        table.coverage td span.cline-no {
            background: #fc8c84;
        }

        .cstat-yes { color: #111; }
        .cstat-no { background: #fc8c84; color: #111; }
        .fstat-no { background: #ffc520; color: #111 !important; }
        .cbranch-no { background:  yellow !important; color: #111; }

        .cstat-skip { background: #ddd; color: #111; }
        .fstat-skip { background: #ddd; color: #111 !important; }
        .cbranch-skip { background: #ddd !important; color: #111; }

        .missing-if-branch {
            display: inline-block;
            margin-right: 10px;
            position: relative;
            padding: 0 4px;
            background: black;
            color: yellow;
        }

        .skip-if-branch {
            display: none;
            margin-right: 10px;
            position: relative;
            padding: 0 4px;
            background: #ccc;
            color: white;
        }

        .missing-if-branch .typ, .skip-if-branch .typ {
            color: inherit !important;
        }

        .entity, .metric { font-weight: bold; }
        .metric { display: inline-block; border: 1px solid #333; padding: 0.3em; background: white; }
        .metric small { font-size: 80%; font-weight: normal; color: #666; }

        div.coverage-summary table { border-collapse: collapse; margin: 3em; font-size: 110%; }
        div.coverage-summary td, div.coverage-summary table  th { margin: 0; padding: 0.25em 1em; border-top: 1px solid #666; border-bottom: 1px solid #666; }
        div.coverage-summary th { text-align: left; border: 1px solid #666; background: #eee; font-weight: normal; }
        div.coverage-summary th.file { border-right: none !important; }
        div.coverage-summary th.pic { border-left: none !important; text-align: right; }
        div.coverage-summary th.pct { border-right: none !important; }
        div.coverage-summary th.abs { border-left: none !important; text-align: right; }
        div.coverage-summary td.pct { text-align: right; border-left: 1px solid #666; }
        div.coverage-summary td.abs { text-align: right; font-size: 90%; color: #444; border-right: 1px solid #666; }
        div.coverage-summary td.file { text-align: right; border-left: 1px solid #666; white-space: nowrap;  }
        div.coverage-summary td.pic { min-width: 120px !important;  }
        div.coverage-summary a:link { color: #000; }
        div.coverage-summary a:visited { color: #333; }
        div.coverage-summary tfoot td { border-top: 1px solid #666; }

        div.coverage-summary .yui3-datatable-sort-indicator, div.coverage-summary .dummy-sort-indicator {
            height: 10px;
            width: 7px;
            display: inline-block;
            margin-left: 0.5em;
        }
        div.coverage-summary .yui3-datatable-sort-indicator {
            background: no-repeat scroll 0 0 transparent;
        }
        div.coverage-summary .yui3-datatable-sorted .yui3-datatable-sort-indicator {
            background-position: 0 -20px;
        }
        div.coverage-summary .yui3-datatable-sorted-desc .yui3-datatable-sort-indicator {
            background-position: 0 -10px;
        }

        .high { background: #b5d592 !important; }
        .medium { background: #ffe87c !important; }
        .low { background: #fc8c84 !important; }

        span.cover-fill, span.cover-empty {
            display:inline-block;
            border:1px solid #444;
            background: white;
            height: 12px;
        }
        span.cover-fill {
            background: #ccc;
            border-right: 1px solid #444;
        }
        span.cover-empty {
            background: white;
            border-left: none;
        }
        span.cover-full {
            border-right: none !important;
        }
        pre.prettyprint {
            border: none !important;
            padding: 0 !important;
            margin: 0 !important;
        }
        .com { color: #999 !important; }
        .ignore-none { color: #999; font-weight: normal; }

    </style>
</head>
<body>
<div class="header low">
    <h1 style="font-weight: bold;">
        <a href="https://github.com/npmtest/node-npmtest-hapi-auth-jwt2">npmtest-hapi-auth-jwt2 (v0.0.1)</a>
    </h1>
    <h1>Code coverage report for <span class="entity">node-npmtest-hapi-auth-jwt2/node_modules/hapi-auth-jwt2/lib/index.js</span></h1>
    <h2>
        
        Statements: <span class="metric">13.79% <small>(12 / 87)</small></span> &nbsp;&nbsp;&nbsp;&nbsp;
        
        
        Branches: <span class="metric">0% <small>(0 / 58)</small></span> &nbsp;&nbsp;&nbsp;&nbsp;
        
        
        Functions: <span class="metric">0% <small>(0 / 14)</small></span> &nbsp;&nbsp;&nbsp;&nbsp;
        
        
        Lines: <span class="metric">13.79% <small>(12 / 87)</small></span> &nbsp;&nbsp;&nbsp;&nbsp;
        
        Ignored: <span class="metric"><span class="ignore-none">none</span></span> &nbsp;&nbsp;&nbsp;&nbsp;
    </h2>
    <div class="path"><a href="../../../../index.html">All files</a> &#187; <a href="index.html">node-npmtest-hapi-auth-jwt2/node_modules/hapi-auth-jwt2/lib/</a> &#187; index.js</div>
</div>
<div class="body">
<pre><table class="coverage">
<tr><td class="line-count">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136
137
138
139
140
141
142
143
144
145
146
147
148
149
150
151
152
153
154
155
156
157
158
159
160
161
162
163
164
165
166
167
168
169
170
171
172
173
174
175
176
177
178
179
180
181
182
183
184
185
186
187
188
189
190
191
192
193
194
195
196
197
198
199
200
201
202
203
204
205
206
207
208
209
210
211
212
213
214
215
216
217
218
219
220
221
222
223
224
225
226
227
228
229
230
231
232
233
234
235
236
237
238</td><td class="line-coverage"><span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1</span>
<span class="cline-any cline-yes">1</span>
<span class="cline-any cline-yes">1</span>
<span class="cline-any cline-yes">1</span>
<span class="cline-any cline-yes">1</span>
<span class="cline-any cline-yes">1</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span></td><td class="text"><pre class="prettyprint lang-js">'use strict';
&nbsp;
var Boom = require('boom');           // error handling https://github.com/hapijs/boom
var assert = require('assert');       // use assert to check if options are set
var JWT = require('jsonwebtoken');    // https://github.com/docdis/learn-json-web-tokens
var extract = require('./extract');   // extract token from Auth Header, URL or Coookie
var pkg = require('../package.json'); // use package name and version rom package.json
var internals = {};                   // see: http://hapijs.com/styleguide#module-globals
&nbsp;
/**
 * register registers the name and exposes the implementation of the plugin
 * see: http://hapijs.com/api#serverplugins for plugin format
 * @param {Object} server - the hapi server to which we are attaching the plugin
 * @param {Object} options - any options set during plugin registration
 * in this case we are not using the options during register but we do later.
 * @param {Function} next - the callback called once registration succeeds
 * @returns {Function} next - returns (calls) the callback when complete.
 */
exports.register = <span class="fstat-no" title="function not covered" >function (server, options, next) {</span>
<span class="cstat-no" title="statement not covered" >  server.auth.scheme('jwt', internals.implementation); </span>// hapijs.com/api#serverauthapi
&nbsp;
<span class="cstat-no" title="statement not covered" >  return next();</span>
};
&nbsp;
/**
 * attributes merely aliases the package.json (re-uses package name &amp; version)
 * simple example: github.com/hapijs/hapi/blob/master/API.md#serverplugins
 */
exports.register.attributes = { // hapi requires attributes for a plugin.
  pkg: pkg                      // also see: http://hapijs.com/tutorials/plugins
};
&nbsp;
/**
 * isFunction checks if a given value is a function.
 * @param {Object} functionToCheck - the object we want to confirm is a function
 * @returns {Boolean} - true if the functionToCheck is a function. :-)
 */
internals.isFunction = <span class="fstat-no" title="function not covered" >function (functionToCheck) {</span>
<span class="cstat-no" title="statement not covered" >  var getType = {};</span>
&nbsp;
<span class="cstat-no" title="statement not covered" >  return functionToCheck</span>
    &amp;&amp; getType.toString.call(functionToCheck) === '[object Function]';
};
&nbsp;
/**
 * isArray checks if a given variable is an Array.
 * @param {Object} variable - the value we want to confirm is an Array
 * @returns {Boolean} - true if the variable is an Array.
 */
internals.isArray = <span class="fstat-no" title="function not covered" >function (variable) {</span>
<span class="cstat-no" title="statement not covered" >  var getType = {};</span>
&nbsp;
<span class="cstat-no" title="statement not covered" >  return variable</span>
    &amp;&amp; getType.toString.call(variable) === '[object Array]';
};
&nbsp;
/**
 * implementation is the "main" interface to the plugin and contains all the
 * "implementation details" (methods) such as authenicate, response &amp; raiseError
 * @param {Object} server - the Hapi.js server object we are attaching the
 * the hapi-auth-jwt2 plugin to.
 * @param {Object} options - any configuration options passed in.
 * @returns {Function} authenicate - we return the authenticate method after
 * registering the plugin as that's the method that gets called for each route.
 */
internals.implementation = <span class="fstat-no" title="function not covered" >function (server, options) {</span>
<span class="cstat-no" title="statement not covered" >  assert(options, 'options are required for jwt auth scheme'); </span>// pre-auth checks
<span class="cstat-no" title="statement not covered" >  assert(options.validateFunc</span>
    || options.verifyFunc, 'validateFunc OR verifyFunc function is required!');
&nbsp;
  // allow custom error raising or default to Boom if no errorFunc is defined
<span class="fstat-no" title="function not covered" >  function raiseError (errorType, message, scheme, attributes) {</span>
<span class="cstat-no" title="statement not covered" >    var errorContext = {</span>
      errorType: errorType,
      message: message,
      scheme: scheme,
      attributes: attributes
    };
<span class="cstat-no" title="statement not covered" >    var _errorType = errorType; </span>  // copies of params
<span class="cstat-no" title="statement not covered" >    var _message = message; </span>      // so we can over-write them below
<span class="cstat-no" title="statement not covered" >    var _scheme = scheme; </span>        // without a linter warning
<span class="cstat-no" title="statement not covered" >    var _attributes = attributes; </span>// if you know a better way please PR!
&nbsp;
<span class="cstat-no" title="statement not covered" >    if (options.errorFunc &amp;&amp; internals.isFunction(options.errorFunc)) {</span>
<span class="cstat-no" title="statement not covered" >      errorContext = options.errorFunc(errorContext);</span>
&nbsp;
<span class="cstat-no" title="statement not covered" >      if (errorContext) {</span>
<span class="cstat-no" title="statement not covered" >        _errorType = errorContext.errorType;</span>
<span class="cstat-no" title="statement not covered" >        _message = errorContext.message;</span>
<span class="cstat-no" title="statement not covered" >        _scheme = errorContext.scheme;</span>
<span class="cstat-no" title="statement not covered" >        _attributes = errorContext.attributes;</span>
      }
    }
&nbsp;
<span class="cstat-no" title="statement not covered" >    return Boom[_errorType](_message, _scheme, _attributes);</span>
  }
&nbsp;
<span class="cstat-no" title="statement not covered" >  return {</span>
    /**
     * authenticate is the "work horse" of the plugin. it's the method that gets
     * called every time a route is requested and needs to validate/verify a JWT
     * @param {Object} request - the standard route handler request object
     * @param {Object} reply - the standard hapi reply interface
     * @returns {Boolean} if the JWT is valid we return a credentials object
     * otherwise throw an error to inform the app &amp; client of unauthorized req.
     */
    authenticate: <span class="fstat-no" title="function not covered" >function (request, reply) {</span>
<span class="cstat-no" title="statement not covered" >      var token = extract(request, options); </span>// extract token Header/Cookie/Query
<span class="cstat-no" title="statement not covered" >      var tokenType = options.tokenType || 'Token'; </span>// see: https://git.io/vXje9
<span class="cstat-no" title="statement not covered" >      var decoded, keyFunc;</span>
&nbsp;
<span class="cstat-no" title="statement not covered" >      if (!token) {</span>
<span class="cstat-no" title="statement not covered" >        return reply(raiseError('unauthorized', null, tokenType));</span>
      }
&nbsp;
<span class="cstat-no" title="statement not covered" >      if (!extract.isValid(token)) { // quick check for validity of token format</span>
<span class="cstat-no" title="statement not covered" >        return reply(raiseError('unauthorized',</span>
          'Invalid token format', tokenType));
      } // verification is done later, but we want to avoid decoding if malformed
<span class="cstat-no" title="statement not covered" >      request.auth.token = token; </span>// keep encoded JWT available in the request
      // otherwise use the same key (String) to validate all JWTs
&nbsp;
<span class="cstat-no" title="statement not covered" >      try {</span>
<span class="cstat-no" title="statement not covered" >        decoded = JWT.decode(token, { complete: options.complete || false });</span>
      } catch (e) { // request should still FAIL if the token does not decode.
<span class="cstat-no" title="statement not covered" >        return reply(raiseError('unauthorized',</span>
          'Invalid token format', tokenType));
      }
&nbsp;
<span class="cstat-no" title="statement not covered" >      if (options.key &amp;&amp; typeof options.validateFunc === 'function') {</span>
        // if keyFunc is function allow dynamic key lookup: https://git.io/vXjvY
<span class="cstat-no" title="statement not covered" >        keyFunc = (internals.isFunction(options.key))</span>
        ? options.key : <span class="fstat-no" title="function not covered" >function (decoded_token, callback) {</span>
<span class="cstat-no" title="statement not covered" >          return callback(null, options.key);</span>
        };
&nbsp;
<span class="cstat-no" title="statement not covered" >        keyFunc(decoded, <span class="fstat-no" title="function not covered" >function (err, key, extraInfo) {</span></span>
<span class="cstat-no" title="statement not covered" >          var verifyOptions = options.verifyOptions || {};</span>
<span class="cstat-no" title="statement not covered" >          var keys = (internals.isArray(key)) ? key : [key];</span>
<span class="cstat-no" title="statement not covered" >          var keysTried = 0;</span>
&nbsp;
<span class="cstat-no" title="statement not covered" >          if (err) {</span>
<span class="cstat-no" title="statement not covered" >            return reply(raiseError('wrap', err));</span>
          }
<span class="cstat-no" title="statement not covered" >          if (extraInfo) {</span>
<span class="cstat-no" title="statement not covered" >            request.plugins[pkg.name] = { extraInfo: extraInfo };</span>
          }
&nbsp;
<span class="cstat-no" title="statement not covered" >          keys.some(<span class="fstat-no" title="function not covered" >function (k) {</span> // itterate through one or more JWT keys</span>
<span class="cstat-no" title="statement not covered" >            JWT.verify(token, k, verifyOptions,</span>
<span class="fstat-no" title="function not covered" >              function (verify_err, verify_decoded) {</span>
<span class="cstat-no" title="statement not covered" >                if (verify_err) {</span>
<span class="cstat-no" title="statement not covered" >                  keysTried++;</span>
<span class="cstat-no" title="statement not covered" >                  if (keysTried &gt;= keys.length) {</span>
<span class="cstat-no" title="statement not covered" >                    return reply(raiseError('unauthorized',</span>
                      'Invalid token', tokenType), null, { credentials: null });
                  }
                  // There are still other keys that might work
&nbsp;
                  // return false;
                } else { // see: http://hapijs.com/tutorials/auth for validateFunc signature
<span class="cstat-no" title="statement not covered" >                  return options.validateFunc(verify_decoded, request,</span>
<span class="fstat-no" title="function not covered" >                    function (validate_err, valid, credentials) {</span> // bring your own checks
<span class="cstat-no" title="statement not covered" >                      if (validate_err) {</span>
<span class="cstat-no" title="statement not covered" >                        return reply(raiseError('wrap', validate_err));</span>
                      }
<span class="cstat-no" title="statement not covered" >                      if (!valid) {</span>
<span class="cstat-no" title="statement not covered" >                        reply(raiseError('unauthorized',</span>
                          'Invalid credentials', tokenType), null,
                          { credentials: credentials || verify_decoded });
                      } else {
<span class="cstat-no" title="statement not covered" >                        reply.continue({</span>
                          credentials: credentials || verify_decoded,
                          artifacts: token
                        });
                      }
&nbsp;
<span class="cstat-no" title="statement not covered" >                      return false;</span>
                    });
                }
&nbsp;
<span class="cstat-no" title="statement not covered" >                return false;</span>
              });
&nbsp;
<span class="cstat-no" title="statement not covered" >            return false;</span>
          });
&nbsp;
<span class="cstat-no" title="statement not covered" >          return true;</span>
        }); // END keyFunc
      } else { // see: https://github.com/dwyl/hapi-auth-jwt2/issues/130
<span class="cstat-no" title="statement not covered" >        return options.verifyFunc(decoded, request,</span>
<span class="fstat-no" title="function not covered" >          function (verify_error, valid, credentials) {</span>
<span class="cstat-no" title="statement not covered" >            if (verify_error) {</span>
<span class="cstat-no" title="statement not covered" >              return reply(raiseError('wrap', verify_error));</span>
            }
<span class="cstat-no" title="statement not covered" >            if (!valid) {</span>
<span class="cstat-no" title="statement not covered" >              reply(raiseError('unauthorized', 'Invalid credentials',</span>
              tokenType), null, { credentials: decoded });
            } else {
<span class="cstat-no" title="statement not covered" >              reply.continue({</span>
                credentials: credentials || decoded,
                artifacts: token
              });
            }
&nbsp;
<span class="cstat-no" title="statement not covered" >            return true;</span>
          });
      }
&nbsp;
<span class="cstat-no" title="statement not covered" >      return true;</span>
    },
    /**
     * response is an Optional method called if an options.responseFunc is set.
     * @param {Object} request - the standard route handler request object
     * @param {Object} reply - the standard hapi reply interface ...
     * after we run the custom options.responseFunc we reply.continue to execute
     * the next plugin in the list.
     * @returns {Boolean} true. always return true (unless there's an error...)
     */
    response: <span class="fstat-no" title="function not covered" >function (request, reply) {</span>
<span class="cstat-no" title="statement not covered" >      if (options.responseFunc &amp;&amp; typeof options.responseFunc === 'function') {</span>
<span class="cstat-no" title="statement not covered" >        options.responseFunc(request, reply, <span class="fstat-no" title="function not covered" >function (err) {</span></span>
<span class="cstat-no" title="statement not covered" >          if (err) {</span>
<span class="cstat-no" title="statement not covered" >            reply(raiseError('wrap', err));</span>
          } else {
<span class="cstat-no" title="statement not covered" >            reply.continue();</span>
          }
        });
      } else {
<span class="cstat-no" title="statement not covered" >        reply.continue();</span>
      }
&nbsp;
<span class="cstat-no" title="statement not covered" >      return true;</span>
    }
  };
};
&nbsp;
&nbsp;</pre></td></tr>
</table></pre>
</div>
<div class="footer">
    <div class="meta">Generated by <a href="https://github.com/kaizhu256/node-utility2" target="_blank">utility2</a> at Thu Apr 20 2017 00:36:13 GMT+0000 (UTC)</div>
</div>
</body>
</html>
